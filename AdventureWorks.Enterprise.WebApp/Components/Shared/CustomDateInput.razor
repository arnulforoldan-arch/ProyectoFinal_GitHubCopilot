@* Componente de fecha documentado *@
@using System.Globalization

<div class="custom-date-input">
    <input type="text"
           class="@InputClass"
           placeholder="dd/MM/yyyy"
           value="@DisplayValue"
           @oninput="OnInputChanged"
           @onblur="OnBlur"
           disabled="@Disabled" />
</div>

@code {
    [Parameter] public DateTime Value { get; set; }
    [Parameter] public EventCallback<DateTime> ValueChanged { get; set; }
    [Parameter] public bool Disabled { get; set; } = false;
    [Parameter] public DateTime? Max { get; set; }
    [Parameter] public DateTime? Min { get; set; }
    [Parameter] public string? CssClass { get; set; }
    [Parameter] public bool IsInvalid { get; set; }

    private string DisplayValue => Value == default ? string.Empty : Value.ToString("dd/MM/yyyy");
    private string InputClass => $"{(string.IsNullOrWhiteSpace(CssClass) ? "form-control" : CssClass)}{(IsInvalid ? " is-invalid" : string.Empty)}";

    private async Task OnInputChanged(ChangeEventArgs e)
    {
        var input = e.Value?.ToString() ?? string.Empty;
        if (DateTime.TryParseExact(input, "dd/MM/yyyy", CultureInfo.InvariantCulture, DateTimeStyles.None, out var date))
        {
            if ((Min == null || date >= Min) && (Max == null || date <= Max))
            {
                Value = date;
                await ValueChanged.InvokeAsync(date);
            }
        }
    }

    private async Task OnBlur() => await ValueChanged.InvokeAsync(Value);
}
